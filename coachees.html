<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mes Coachés - Job-search IA & Coach</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
  <link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="css/main.css">
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

  <div class="flex flex-col md:flex-row">
    <!-- Navigation -->
    <nav aria-label="alternative nav">
      <div class="bg-gray-800 shadow-xl h-20 fixed bottom-0 mt-12 md:relative md:h-screen z-10 w-full md:w-48 content-center">
        <div class="md:mt-12 md:w-48 md:fixed md:left-0 md:top-0 content-center md:content-start text-left justify-between">
          <ul class="list-reset flex flex-row md:flex-col pt-3 md:py-3 px-1 md:px-2 text-center md:text-left">
            <li class="mr-3 flex-1">
              <a href="index.html" class="block py-1 md:py-3 pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-blue-500">
                <i class="fas fa-chart-area pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-400 md:text-gray-200 block md:inline-block">Tableau de bord</span>
              </a>
            </li>
            <li class="mr-3 flex-1">
              <a href="prompts-library.html" class="block py-1 md:py-3 pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-green-500">
                <i class="fas fa-comment-alt pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-400 md:text-gray-200 block md:inline-block">Prompts IA</span>
              </a>
            </li>
            <li class="mr-3 flex-1">
              <a href="coachees.html" class="block py-1 md:py-3 pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-purple-600">
                <i class="fas fa-users pr-0 md:pr-3 text-purple-600"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-white md:text-white block md:inline-block">Mes coachés</span>
              </a>
            </li>
            <li class="mr-3 flex-1">
              <a href="resources.html" class="block py-1 md:py-3 pl-0 md:pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-red-500">
                <i class="fas fa-book pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-400 md:text-gray-200 block md:inline-block">Ressources</span>
              </a>
            </li>
            <!-- Dans la navigation de coachees.html -->
            <li class="mr-3 flex-1">
              <a href="calendrier.html" class="block py-1 md:py-3 pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-orange-500">
                <i class="fas fa-calendar-alt pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-400 md:text-gray-200 block md:inline-block">Calendrier</span>
            </a>
            </li>
            <li class="mr-3 flex-1">
              <a href="prompt-test.html" class="block py-1 md:py-3 pl-0 md:pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-yellow-500">
                <i class="fas fa-vial pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-400 md:text-gray-200 block md:inline-block">Test des Prompts</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Contenu principal -->
    <div id="main" class="main-content flex-1 bg-gray-100 pb-24 md:pb-5">
      <div class="bg-gray-800 pt-3">
        <div class="rounded-tl-3xl bg-gradient-to-r from-blue-900 to-gray-800 p-4 shadow text-2xl text-white">
          <h1 class="font-bold pl-2">Mes Coachés</h1>
        </div>
      </div>
      
      <!-- Section de filtres -->
      <div class="p-6">
        <div class="bg-white rounded-lg shadow-xl p-5">
          <div class="filters-container bg-gray-50 p-4 rounded-lg mb-6">
            <div class="flex flex-wrap gap-4 items-center">
              <div class="search-box relative">
                <input type="text" placeholder="Rechercher un coaché..." id="coachee-search" class="pl-9 pr-3 py-2 border border-gray-300 rounded-md">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              
              <div class="filter-group flex flex-wrap gap-3">
                <select id="status-filter" class="filter-select border border-gray-300 rounded-md px-3 py-2">
                  <option value="all">Tous les statuts</option>
                  <option value="active">Actif</option>
                  <option value="pending">En attente</option>
                  <option value="completed">Terminé</option>
                </select>
          
<!-- Carte coaché dynamique -->
<div class="coachee-card bg-white rounded-lg shadow-md overflow-hidden" data-coachee-id="marie-dupont">
  <div class="coachee-header flex justify-between items-center p-4 bg-gray-50 border-b border-gray-200">
    <div class="coachee-avatar w-10 h-10 rounded-full flex items-center justify-center text-white font-bold" style="background-color: #3498DB;">MD</div>
    <div class="flex items-center gap-2">
      <!-- Badge fictif (conditionnel) -->
      <div class="fictional-badge px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800" style="display: none;">Fictif</div>
      <div class="coachee-status px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Actif</div>
    </div>
    <div class="coachee-actions flex gap-1">
      <button onclick="editCoachee('marie-dupont')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Modifier">
        <i class="fas fa-edit"></i>
      </button>
      <button onclick="toggleCoacheeMenu('marie-dupont')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Plus d'options">
        <i class="fas fa-ellipsis-v"></i>
      </button>
    </div>
  </div>
  <div class="coachee-body p-4">
    <h3 class="coachee-name text-lg font-bold mb-1">Marie Dupont</h3>
    <p class="coachee-position text-sm text-gray-600 mb-3">Marketing Digital</p>
    <div class="progress-container h-2 bg-gray-200 rounded-full overflow-hidden mb-3">
      <div class="progress-bar h-full bg-gradient-to-r from-blue-500 to-purple-500 relative" style="width: 90%;">
        <span class="absolute right-0 top-0 transform translate-y-4 text-xs text-gray-600">9/10</span>
      </div>
    </div>
    <p class="current-stage flex items-center text-sm text-gray-700 mb-2">
      <i class="fas fa-tasks mr-2 text-gray-500"></i>
      <span>Préparation Entretien</span>
    </p>
    <p class="last-activity flex items-center text-sm text-gray-700">
      <i class="fas fa-clock mr-2 text-gray-500"></i>
      <span>Dernière activité : Aujourd'hui, 10:30</span>
    </p>
  </div>
  <div class="coachee-footer flex justify-between p-4 border-t border-gray-200 bg-gray-50">
    <button onclick="startSession('Marie Dupont', '9')" class="btn-action flex items-center px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded">
      <i class="fas fa-play mr-1"></i> Session
    </button>
    <button onclick="openDossier('Marie Dupont')" class="btn-action flex items-center px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded">
      <i class="fas fa-folder-open mr-1"></i> Dossier
    </button>
  </div>
  
  <!-- Menu contextuel (caché par défaut) -->
  <div id="menu-marie-dupont" class="coachee-menu absolute right-4 top-16 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden">
    <button onclick="editCoachee('marie-dupont')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-edit mr-2 text-blue-600"></i>Modifier
    </button>
    <button onclick="duplicateCoachee('marie-dupont')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-copy mr-2 text-green-600"></i>Dupliquer
    </button>
    <button onclick="exportCoachee('marie-dupont')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-download mr-2 text-purple-600"></i>Exporter
    </button>
    <hr class="my-1">
    <button onclick="deleteCoachee('marie-dupont')" class="block w-full text-left px-4 py-2 text-sm hover:bg-red-50 text-red-600">
      <i class="fas fa-trash mr-2"></i>Supprimer
    </button>
  </div>
</div>
            
<!-- Carte coaché 2 - Thomas Martin -->
<div class="coachee-card bg-white rounded-lg shadow-md overflow-hidden" data-coachee-id="thomas-martin">
  <div class="coachee-header flex justify-between items-center p-4 bg-gray-50 border-b border-gray-200">
    <div class="coachee-avatar w-10 h-10 rounded-full flex items-center justify-center text-white font-bold" style="background-color: #E67E22;">TM</div>
    <div class="flex items-center gap-2">
      <!-- Badge fictif (conditionnel) -->
      <div class="fictional-badge px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800" style="display: none;">Fictif</div>
      <div class="coachee-status px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">En attente</div>
    </div>
    <div class="coachee-actions flex gap-1">
      <button onclick="editCoachee('thomas-martin')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Modifier">
        <i class="fas fa-edit"></i>
      </button>
      <button onclick="toggleCoacheeMenu('thomas-martin')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Plus d'options">
        <i class="fas fa-ellipsis-v"></i>
      </button>
    </div>
  </div>
  <div class="coachee-body p-4">
    <h3 class="coachee-name text-lg font-bold mb-1">Thomas Martin</h3>
    <p class="coachee-position text-sm text-gray-600 mb-3">Développement Web</p>
    <div class="progress-container h-2 bg-gray-200 rounded-full overflow-hidden mb-3">
      <div class="progress-bar h-full bg-gradient-to-r from-blue-500 to-purple-500 relative" style="width: 40%;">
        <span class="absolute right-0 top-0 transform translate-y-4 text-xs text-gray-600">4/10</span>
      </div>
    </div>
    <p class="current-stage flex items-center text-sm text-gray-700 mb-2">
      <i class="fas fa-tasks mr-2 text-gray-500"></i>
      <span>Analyse CV</span>
    </p>
    <p class="last-activity flex items-center text-sm text-gray-700">
      <i class="fas fa-clock mr-2 text-gray-500"></i>
      <span>Dernière activité : Hier, 14:45</span>
    </p>
  </div>
  <div class="coachee-footer flex justify-between p-4 border-t border-gray-200 bg-gray-50">
    <button onclick="startSession('Thomas Martin', '4')" class="btn-action flex items-center px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded">
      <i class="fas fa-play mr-1"></i> Session
    </button>
    <button onclick="openDossier('Thomas Martin')" class="btn-action flex items-center px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded">
      <i class="fas fa-folder-open mr-1"></i> Dossier
    </button>
  </div>
  
  <!-- Menu contextuel (caché par défaut) -->
  <div id="menu-thomas-martin" class="coachee-menu absolute right-4 top-16 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden">
    <button onclick="editCoachee('thomas-martin')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-edit mr-2 text-blue-600"></i>Modifier
    </button>
    <button onclick="duplicateCoachee('thomas-martin')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-copy mr-2 text-green-600"></i>Dupliquer
    </button>
    <button onclick="exportCoachee('thomas-martin')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-download mr-2 text-purple-600"></i>Exporter
    </button>
    <hr class="my-1">
    <button onclick="deleteCoachee('thomas-martin')" class="block w-full text-left px-4 py-2 text-sm hover:bg-red-50 text-red-600">
      <i class="fas fa-trash mr-2"></i>Supprimer
    </button>
  </div>
</div>
            
<!-- Carte coaché 3 - Sophie Laurent -->
<div class="coachee-card bg-white rounded-lg shadow-md overflow-hidden" data-coachee-id="sophie-laurent">
  <div class="coachee-header flex justify-between items-center p-4 bg-gray-50 border-b border-gray-200">
    <div class="coachee-avatar w-10 h-10 rounded-full flex items-center justify-center text-white font-bold" style="background-color: #9B59B6;">SL</div>
    <div class="flex items-center gap-2">
      <!-- Badge fictif (conditionnel) -->
      <div class="fictional-badge px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800" style="display: none;">Fictif</div>
      <div class="coachee-status px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Actif</div>
    </div>
    <div class="coachee-actions flex gap-1">
      <button onclick="editCoachee('sophie-laurent')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Modifier">
        <i class="fas fa-edit"></i>
      </button>
      <button onclick="toggleCoacheeMenu('sophie-laurent')" class="btn-icon w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200" title="Plus d'options">
        <i class="fas fa-ellipsis-v"></i>
      </button>
    </div>
  </div>
  <div class="coachee-body p-4">
    <h3 class="coachee-name text-lg font-bold mb-1">Sophie Laurent</h3>
    <p class="coachee-position text-sm text-gray-600 mb-3">Chef de Projet</p>
    <div class="progress-container h-2 bg-gray-200 rounded-full overflow-hidden mb-3">
      <div class="progress-bar h-full bg-gradient-to-r from-blue-500 to-purple-500 relative" style="width: 10%;">
        <span class="absolute right-0 top-0 transform translate-y-4 text-xs text-gray-600">1/10</span>
      </div>
    </div>
    <p class="current-stage flex items-center text-sm text-gray-700 mb-2">
      <i class="fas fa-tasks mr-2 text-gray-500"></i>
      <span>Diagnostic Initial</span>
    </p>
    <p class="last-activity flex items-center text-sm text-gray-700">
      <i class="fas fa-clock mr-2 text-gray-500"></i>
      <span>Dernière activité : 23/05/2025, 11:15</span>
    </p>
  </div>
  <div class="coachee-footer flex justify-between p-4 border-t border-gray-200 bg-gray-50">
    <button onclick="startSession('Sophie Laurent', '1')" class="btn-action flex items-center px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded">
      <i class="fas fa-play mr-1"></i> Session
    </button>
    <button onclick="openDossier('Sophie Laurent')" class="btn-action flex items-center px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded">
      <i class="fas fa-folder-open mr-1"></i> Dossier
    </button>
  </div>
  
  <!-- Menu contextuel (caché par défaut) -->
  <div id="menu-sophie-laurent" class="coachee-menu absolute right-4 top-16 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden">
    <button onclick="editCoachee('sophie-laurent')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-edit mr-2 text-blue-600"></i>Modifier
    </button>
    <button onclick="duplicateCoachee('sophie-laurent')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-copy mr-2 text-green-600"></i>Dupliquer
    </button>
    <button onclick="exportCoachee('sophie-laurent')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
      <i class="fas fa-download mr-2 text-purple-600"></i>Exporter
    </button>
    <hr class="my-1">
    <button onclick="deleteCoachee('sophie-laurent')" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 text-red-600">
      <i class="fas fa-trash mr-2"></i>Supprimer
    </button>
  </div>
</div>
      
      <!-- Modal d'ajout d'un nouveau coaché (caché par défaut) -->
      <div id="add-coachee-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="modal-content bg-white w-full max-w-md mx-4 rounded-lg shadow-xl">
          <div class="flex justify-between items-center p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold">Ajouter un nouveau coaché</h2>
            <span class="close text-2xl cursor-pointer">&times;</span>
          </div>
          
          <form id="new-coachee-form" class="p-6">
            <div class="form-group mb-4">
              <label for="coachee-name" class="block text-sm font-medium text-gray-700 mb-1">Nom complet</label>
              <input type="text" id="coachee-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div class="form-group mb-4">
              <label for="coachee-position" class="block text-sm font-medium text-gray-700 mb-1">Poste recherché</label>
              <input type="text" id="coachee-position" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div class="form-group mb-4">
              <label for="coachee-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input type="email" id="coachee-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div class="form-group mb-4">
              <label for="coachee-phone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
              <input type="tel" id="coachee-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div class="form-group mb-4">
              <label for="coachee-notes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
              <textarea id="coachee-notes" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
            </div>
            <div class="form-actions flex justify-end space-x-3">
              <button type="button" class="cancel-btn px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded">Annuler</button>
              <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Ajouter</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <script src="js/coachees.js"></script>
<script>
// Gestion avancée des coachés - Version adaptée à votre structure
let coachees = [];
let currentCoacheeToDelete = null;

document.addEventListener('DOMContentLoaded', function() {
    console.log('Initialisation de la gestion des coachés...');
    initializeCoacheesManagement();
    setupEventListeners();
});

function initializeCoacheesManagement() {
    loadCoacheesData();
    updateCoacheesDisplay();

    // Nouvelle ligne à ajouter :
    setupExistingFilters();

    // Gestionnaire pour fermer les menus quand on clique ailleurs
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.coachee-actions')) {
            closeAllMenus();
        }
    });
}

function setupEventListeners() {
    // Gestionnaire du formulaire d'ajout/modification
    const form = document.getElementById('coacheeForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            saveCoachee();
        });
    }
    
    // Gestionnaire pour les boutons de filtres
    document.querySelectorAll('.flex.flex-wrap button').forEach(button => {
        if (button.textContent.trim() !== 'Coachés fictifs' && button.textContent.trim() !== 'Ajouter un coaché') {
            button.addEventListener('click', function() {
                filterCoachees(this.textContent.trim());
            });
        }
    });
}

// ========== GESTION DES DONNÉES ==========

function loadCoacheesData() {
    const savedCoachees = localStorage.getItem('coachees_data');
    
    if (savedCoachees) {
        coachees = JSON.parse(savedCoachees);
        console.log('Coachés chargés depuis localStorage:', coachees);
    } else {
        // Initialiser avec les coachés fictifs
        coachees = [
            {
                id: 'marie-dupont',
                name: 'Marie Dupont',
                sector: 'Marketing Digital',
                email: 'marie.dupont@email.com',
                phone: '06 12 34 56 78',
                currentStep: 9,
                status: 'active',
                startDate: '2024-11-01',
                lastActivity: new Date().toISOString(),
                isFictional: true,
                avatar: 'MD',
                avatarColor: '#3498DB'
            },
            {
                id: 'thomas-martin',
                name: 'Thomas Martin',
                sector: 'Développement Web',
                email: 'thomas.martin@email.com',
                phone: '06 23 45 67 89',
                currentStep: 4,
                status: 'pending',
                startDate: '2024-11-15',
                lastActivity: new Date(Date.now() - 86400000).toISOString(),
                isFictional: true,
                avatar: 'TM',
                avatarColor: '#E67E22'
            },
            {
                id: 'sophie-laurent',
                name: 'Sophie Laurent',
                sector: 'Chef de Projet',
                email: 'sophie.laurent@email.com',
                phone: '06 34 56 78 90',
                currentStep: 1,
                status: 'active',
                startDate: '2024-12-01',
                lastActivity: new Date(Date.now() - 172800000).toISOString(),
                isFictional: true,
                avatar: 'SL',
                avatarColor: '#9B59B6'
            }
        ];
        saveCoacheesData();
        console.log('Coachés fictifs initialisés');
    }
}

function saveCoacheesData() {
    localStorage.setItem('coachees_data', JSON.stringify(coachees));
    console.log('Données coachés sauvegardées');
}

function updateCoacheesDisplay() {
    // Mettre à jour chaque carte avec les données actuelles
    coachees.forEach(coachee => {
        updateCoacheeCard(coachee);
    });
    
    // Marquer les coachés fictifs
    markFictionalCoachees();
}

function updateCoacheeCard(coachee) {
    const card = document.querySelector(`[data-coachee-id="${coachee.id}"]`);
    if (!card) return;
    
    // Mettre à jour le nom
    const nameElement = card.querySelector('.coachee-name');
    if (nameElement) nameElement.textContent = coachee.name;
    
    // Mettre à jour le secteur
    const sectorElement = card.querySelector('.coachee-position');
    if (sectorElement) sectorElement.textContent = coachee.sector;
    
    // Mettre à jour le statut
    const statusElement = card.querySelector('.coachee-status');
    if (statusElement) {
        statusElement.textContent = getStatusText(coachee.status);
        statusElement.className = `px-2 py-1 text-xs rounded-full ${getStatusClasses(coachee.status)}`;
    }
    
    // Mettre à jour la progression
    const progressBar = card.querySelector('.progress-bar');
    const progressText = card.querySelector('.progress-bar span');
    if (progressBar && progressText) {
        const percentage = (coachee.currentStep / 10) * 100;
        progressBar.style.width = percentage + '%';
        progressText.textContent = `${coachee.currentStep}/10`;
    }
    
    // Mettre à jour l'étape actuelle
    const stageElement = card.querySelector('.current-stage span');
    if (stageElement) {
        stageElement.textContent = getStepName(coachee.currentStep);
    }
    
    // Mettre à jour l'activité
    const activityElement = card.querySelector('.last-activity span');
    if (activityElement) {
        activityElement.textContent = `Dernière activité : ${formatLastActivity(coachee.lastActivity)}`;
    }
}

function markFictionalCoachees() {
    coachees.forEach(coachee => {
        if (coachee.isFictional) {
            const card = document.querySelector(`[data-coachee-id="${coachee.id}"]`);
            if (card) {
                const badge = card.querySelector('.fictional-badge');
                if (badge) {
                    badge.style.display = 'block';
                }
            }
        }
    });
}

// ========== GESTION DES MENUS ==========

function toggleCoacheeMenu(coacheeId) {
    closeAllMenus();
    const menu = document.getElementById(`menu-${coacheeId}`);
    if (menu) {
        menu.classList.toggle('hidden');
    }
}

function closeAllMenus() {
    const menus = document.querySelectorAll('.coachee-menu');
    menus.forEach(menu => menu.classList.add('hidden'));
}

// ========== ACTIONS SUR LES COACHÉS ==========

function editCoachee(coacheeId) {
    closeAllMenus();
    const coachee = coachees.find(c => c.id === coacheeId);
    if (!coachee) return;
    
    // Remplir le formulaire avec les données existantes
    document.getElementById('modalTitle').textContent = 'Modifier le coaché';
    document.getElementById('submitButtonText').textContent = 'Modifier';
    document.getElementById('coacheeId').value = coachee.id;
    document.getElementById('coacheeName').value = coachee.name;
    document.getElementById('coacheeSector').value = coachee.sector;
    document.getElementById('coacheeEmail').value = coachee.email || '';
    document.getElementById('coacheePhone').value = coachee.phone || '';
    document.getElementById('coacheeCurrentStep').value = coachee.currentStep;
    document.getElementById('coacheeStatus').value = coachee.status;
    
    document.getElementById('coacheeModal').classList.remove('hidden');
}

function duplicateCoachee(coacheeId) {
    closeAllMenus();
    const coachee = coachees.find(c => c.id === coacheeId);
    if (!coachee) return;
    
    const newCoachee = {
        ...coachee,
        id: generateId(),
        name: coachee.name + ' (Copie)',
        isFictional: false,
        startDate: new Date().toISOString().split('T')[0],
        lastActivity: new Date().toISOString()
    };
    
    coachees.push(newCoachee);
    saveCoacheesData();
    
    showNotification(`${coachee.name} dupliqué avec succès !`, 'success');
    
    // Recharger la page pour afficher le nouveau coaché
    setTimeout(() => location.reload(), 1000);
}

function exportCoachee(coacheeId) {
    closeAllMenus();
    const coachee = coachees.find(c => c.id === coacheeId);
    if (!coachee) return;
    
    // Exporter les données du coaché en JSON
    const exportData = {
        coachee: coachee,
        sessions: JSON.parse(localStorage.getItem(`sessions_history_${coachee.name}`)) || [],
        notes: localStorage.getItem(`coach_notes_${coachee.name}`) || '',
        progress: JSON.parse(localStorage.getItem(`coached_progress_${coachee.name}`)) || {},
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `${coachee.name.replace(/\s+/g, '_')}_export.json`;
    link.click();
    
    showNotification(`Données de ${coachee.name} exportées !`, 'success');
}

function deleteCoachee(coacheeId) {
    closeAllMenus();
    const coachee = coachees.find(c => c.id === coacheeId);
    if (!coachee) return;
    
    currentCoacheeToDelete = coacheeId;
    document.getElementById('deleteCoacheeName').textContent = coachee.name;
    document.getElementById('deleteModal').classList.remove('hidden');
}

function confirmDelete() {
    if (!currentCoacheeToDelete) return;
    
    const coachee = coachees.find(c => c.id === currentCoacheeToDelete);
    if (!coachee) return;
    
    // Supprimer le coaché de la liste
    coachees = coachees.filter(c => c.id !== currentCoacheeToDelete);
    
    // Nettoyer toutes les données associées
    cleanupCoacheeData(coachee.name);
    
    // Supprimer la carte du DOM
    const card = document.querySelector(`[data-coachee-id="${currentCoacheeToDelete}"]`);
    if (card) {
        card.remove();
    }
    
    saveCoacheesData();
    closeDeleteModal();
    
    showNotification(`${coachee.name} supprimé avec succès !`, 'success');
}

function cleanupCoacheeData(coacheeName) {
    // Supprimer toutes les données associées au coaché
    const keysToRemove = [
        `sessions_history_${coacheeName}`,
        `session_notes_${coacheeName}`,
        `coached_profile_${coacheeName}`,
        `coach_notes_${coacheeName}`,
        `coached_progress_${coacheeName}`,
        `documents_${coacheeName}`,
        `objectives_${coacheeName}`
    ];
    
    keysToRemove.forEach(key => localStorage.removeItem(key));
    
    // Supprimer les rendez-vous
    const appointments = JSON.parse(localStorage.getItem('coach_appointments')) || [];
    const filteredAppointments = appointments.filter(apt => apt.coachee !== coacheeName);
    localStorage.setItem('coach_appointments', JSON.stringify(filteredAppointments));
    
    console.log(`Données supprimées pour ${coacheeName}`);
}

// ========== GESTION DES COACHÉS FICTIFS ==========

function showFictionalCoacheesOptions() {
    const fictionalCoachees = coachees.filter(c => c.isFictional);
    
    if (fictionalCoachees.length === 0) {
        showNotification('Aucun coaché fictif trouvé !', 'info');
        return;
    }
    
    // Mettre à jour le compteur
    document.getElementById('fictionalCount').textContent = `${fictionalCoachees.length} coachés fictifs`;
    
    // Afficher le modal
    document.getElementById('fictionalModal').classList.remove('hidden');
}

function closeFictionalModal() {
    document.getElementById('fictionalModal').classList.add('hidden');
}

function convertFictionalToReal() {
    const fictionalCoachees = coachees.filter(c => c.isFictional);
    
    if (confirm(`Convertir ${fictionalCoachees.length} coachés fictifs en vrais coachés ?\n\nIls ne seront plus marqués comme fictifs.`)) {
        // Convertir tous les coachés fictifs
        coachees.forEach(coachee => {
            if (coachee.isFictional) {
                coachee.isFictional = false;
                coachee.startDate = new Date().toISOString().split('T')[0];
                coachee.lastActivity = new Date().toISOString();
            }
        });
        
        saveCoacheesData();
        updateCoacheesDisplay();
        closeFictionalModal();
        
        // Masquer les badges fictifs
        const badges = document.querySelectorAll('.fictional-badge');
        badges.forEach(badge => badge.style.display = 'none');
        
        showNotification(`${fictionalCoachees.length} coachés convertis en vrais coachés !`, 'success');
    }
}

function removeAllFictionalCoachees() {
    const fictionalCoachees = coachees.filter(c => c.isFictional);
    
    if (confirm(`Supprimer définitivement ${fictionalCoachees.length} coachés fictifs ?\n\nCette action supprimera toutes leurs données (sessions, notes, rendez-vous).`)) {
        fictionalCoachees.forEach(coachee => {
            cleanupCoacheeData(coachee.name);
            
            // Supprimer la carte du DOM
            const card = document.querySelector(`[data-coachee-id="${coachee.id}"]`);
            if (card) {
                card.remove();
            }
        });
        
        // Supprimer de la liste
        coachees = coachees.filter(c => !c.isFictional);
        saveCoacheesData();
        closeFictionalModal();
        
        showNotification(`${fictionalCoachees.length} coachés fictifs supprimés !`, 'success');
    }
}

// ========== MODAL DE GESTION ==========

function openAddCoacheeModal() {
    document.getElementById('modalTitle').textContent = 'Ajouter un coaché';
    document.getElementById('submitButtonText').textContent = 'Ajouter';
    document.getElementById('coacheeForm').reset();
    document.getElementById('coacheeId').value = '';
    document.getElementById('coacheeModal').classList.remove('hidden');
}

function saveCoachee() {
    const coacheeId = document.getElementById('coacheeId').value;
    const isEdit = coacheeId !== '';
    
    const coacheeData = {
        id: isEdit ? coacheeId : generateId(),
        name: document.getElementById('coacheeName').value,
        sector: document.getElementById('coacheeSector').value,
        email: document.getElementById('coacheeEmail').value,
        phone: document.getElementById('coacheePhone').value,
        currentStep: parseInt(document.getElementById('coacheeCurrentStep').value),
        status: document.getElementById('coacheeStatus').value,
        startDate: isEdit ? coachees.find(c => c.id === coacheeId)?.startDate : new Date().toISOString().split('T')[0],
        lastActivity: new Date().toISOString(),
        isFictional: false,
        avatar: generateAvatar(document.getElementById('coacheeName').value),
        avatarColor: generateAvatarColor()
    };
    
    if (isEdit) {
        // Modifier
        const index = coachees.findIndex(c => c.id === coacheeId);
        if (index !== -1) {
            coachees[index] = { ...coachees[index], ...coacheeData };
            updateCoacheeCard(coacheeData);
        }
    } else {
        // Ajouter
        coachees.push(coacheeData);
        // Recharger la page pour afficher le nouveau coaché
        setTimeout(() => location.reload(), 1000);
    }
    
    saveCoacheesData();
    closeCoacheeModal();
    
    showNotification(isEdit ? 'Coaché modifié avec succès !' : 'Coaché ajouté avec succès !', 'success');
}

function closeCoacheeModal() {
    document.getElementById('coacheeModal').classList.add('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    currentCoacheeToDelete = null;
}

// ========== FONCTIONS UTILITAIRES ==========

function generateId() {
    return 'coachee-' + Date.now().toString(36) + Math.random().toString(36).substr(2);
}

function generateAvatar(name) {
    const words = name.split(' ');
    return words.map(word => word.charAt(0).toUpperCase()).join('').substring(0, 2);
}

function generateAvatarColor() {
    const colors = ['#3498DB', '#E67E22', '#9B59B6', '#27AE60', '#F39C12', '#E74C3C', '#1ABC9C', '#34495E'];
    return colors[Math.floor(Math.random() * colors.length)];
}

function getStatusText(status) {
    const statusMap = {
        'active': 'Actif',
        'pending': 'En attente',
        'completed': 'Terminé',
        'paused': 'En pause'
    };
    return statusMap[status] || 'Inconnu';
}

function getStatusClasses(status) {
    const classMap = {
        'active': 'bg-green-100 text-green-800',
        'pending': 'bg-yellow-100 text-yellow-800',
        'completed': 'bg-blue-100 text-blue-800',
        'paused': 'bg-gray-100 text-gray-800'
    };
    return classMap[status] || 'bg-gray-100 text-gray-800';
}

function getStepName(stepNumber) {
    const stepNames = {
        1: 'Diagnostic de départ',
        2: 'Analyse du marché',
        3: 'Plan d\'action détaillé',
        4: 'Analyse CV',
        5: 'Recherche entreprise',
        6: 'Matching CV / Offre',
        7: 'Lettres de motivation',
        8: 'Ciblage offres',
        9: 'Préparation entretien',
        10: 'Bilan du coaching'
    };
    return stepNames[stepNumber] || 'Étape inconnue';
}

function formatLastActivity(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) return "Aujourd'hui";
    if (diffDays === 2) return "Hier";
    if (diffDays <= 7) return `Il y a ${diffDays - 1} jours`;
    
    return date.toLocaleDateString('fr-FR');
}

function filterCoachees(category) {
    const cards = document.querySelectorAll('.coachee-card');
    const buttons = document.querySelectorAll('.flex.flex-wrap button');
    
    // Réinitialiser les styles des boutons (sauf les boutons spéciaux)
    buttons.forEach(btn => {
        if (btn.textContent.trim() !== 'Coachés fictifs' && btn.textContent.trim() !== 'Ajouter un coaché') {
            btn.classList.remove('bg-gray-800', 'text-white');
            btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-800');
        }
    });
    
    // Activer le bouton cliqué
    if (event && event.target) {
        event.target.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-800');
        event.target.classList.add('bg-gray-800', 'text-white');
    }
    
    // Filtrer les cartes
    cards.forEach(card => {
        const position = card.querySelector('.coachee-position')?.textContent.toLowerCase() || '';
        const stage = card.querySelector('.current-stage span')?.textContent.toLowerCase() || '';
        
        if (category.toLowerCase() === 'tous' || 
            position.includes(category.toLowerCase()) || 
            stage.includes(category.toLowerCase())) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function startSession(coacheeName, step) {
    window.location.href = `session.html?name=${encodeURIComponent(coacheeName)}&step=${step}`;
}

function openDossier(coacheeName) {
    window.location.href = `dossier.html?name=${encodeURIComponent(coacheeName)}`;
}

function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    const bgColor = type === 'success' ? 'notification-success' : 
                   type === 'error' ? 'notification-error' : 
                   type === 'warning' ? 'notification-warning' : 'notification-info';
    
    const iconClass = type === 'success' ? 'fa-check-circle' : 
                     type === 'error' ? 'fa-exclamation-triangle' : 
                     type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
    
    notification.className = `fixed top-4 right-4 text-white px-6 py-3 rounded shadow-lg z-50 transform translate-x-full transition-all duration-300 ${bgColor}`;
    notification.innerHTML = `
        <div class="flex items-center">
            <i class="fas ${iconClass} mr-2"></i>
            <span>${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animation d'apparition
    setTimeout(() => notification.style.transform = 'translateX(0)', 100);
    
    // Suppression automatique
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => notification.remove(), 300);
        }
    }, duration);
}
</script>
<!-- Modal Ajouter/Modifier Coaché -->
<div id="coacheeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 id="modalTitle" class="text-lg font-bold">Ajouter un coaché</h3>
            <button onclick="closeCoacheeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <form id="coacheeForm">
            <input type="hidden" id="coacheeId" value="">
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Nom complet *</label>
                <input type="text" id="coacheeName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Jean Dupont">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Secteur d'activité *</label>
                <input type="text" id="coacheeSector" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Marketing Digital">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="coacheeEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: jean.dupont@email.com">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                <input type="tel" id="coacheePhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: 06 12 34 56 78">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Étape actuelle</label>
                <select id="coacheeCurrentStep" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="1">1. Diagnostic de départ</option>
                    <option value="2">2. Analyse du marché</option>
                    <option value="3">3. Plan d'action détaillé</option>
                    <option value="4">4. Analyse CV</option>
                    <option value="5">5. Recherche entreprise</option>
                    <option value="6">6. Matching CV / Offre</option>
                    <option value="7">7. Lettres de motivation</option>
                    <option value="8">8. Ciblage offres</option>
                    <option value="9">9. Préparation entretien</option>
                    <option value="10">10. Bilan du coaching</option>
                </select>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Statut</label>
                <select id="coacheeStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="active">Actif</option>
                    <option value="pending">En attente</option>
                    <option value="completed">Terminé</option>
                    <option value="paused">En pause</option>
                </select>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeCoacheeModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-md">
                    Annuler
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md">
                    <i class="fas fa-save mr-1"></i>
                    <span id="submitButtonText">Ajouter</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmation de suppression -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm mx-4">
        <div class="text-center">
            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
            <h3 class="text-lg font-bold mb-2">Confirmer la suppression</h3>
            <p class="text-gray-600 mb-4">Êtes-vous sûr de vouloir supprimer <strong id="deleteCoacheeName"></strong> ?</p>
            <p class="text-sm text-red-600 mb-6">Cette action supprimera toutes les données associées (sessions, notes, rendez-vous).</p>
            
            <div class="flex justify-center space-x-3">
                <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-md">
                    Annuler
                </button>
                <button onclick="confirmDelete()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md">
                    <i class="fas fa-trash mr-1"></i>
                    Supprimer
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de gestion des coachés fictifs -->
<div id="fictionalModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
        <div class="text-center">
            <i class="fas fa-magic text-orange-500 text-4xl mb-4"></i>
            <h3 class="text-lg font-bold mb-4">Gestion des Coachés Fictifs</h3>
            
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                <p class="text-orange-800 text-sm mb-3">
                    <strong id="fictionalCount">3 coachés fictifs</strong> détectés dans votre application :
                </p>
                <div class="space-y-2 text-left text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-user text-orange-600 mr-2"></i>
                        <span>Marie Dupont (Marketing Digital)</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-user text-orange-600 mr-2"></i>
                        <span>Thomas Martin (Développement Web)</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-user text-orange-600 mr-2"></i>
                        <span>Sophie Laurent (Chef de Projet)</span>
                    </div>
                </div>
            </div>
            
            <p class="text-gray-600 text-sm mb-6">
                Ces coachés ont été créés pour la démonstration. Vous pouvez les supprimer pour commencer avec de vrais coachés.
            </p>
            
            <div class="flex flex-col space-y-3">
                <button onclick="removeAllFictionalCoachees()" class="w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md">
                    <i class="fas fa-trash mr-2"></i>
                    Supprimer tous les coachés fictifs
                </button>
                <button onclick="convertFictionalToReal()" class="w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md">
                    <i class="fas fa-user-check mr-2"></i>
                    Convertir en vrais coachés
                </button>
                <button onclick="closeFictionalModal()" class="w-full px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-md">
                    Conserver pour le moment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Notification toast (template) -->
<div id="notificationTemplate" class="hidden">
    <div class="fixed top-4 right-4 text-white px-6 py-3 rounded shadow-lg z-50 transform translate-x-full transition-all duration-300">
        <div class="flex items-center">
            <i class="fas fa-info-circle mr-2"></i>
            <span class="notification-message"></span>
        </div>
    </div>
</div>
</body>
</html>
